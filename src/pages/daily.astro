---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const microlessons = await getCollection('microlessons');
const url = new URL(Astro.request.url);
const tagFilter = url.searchParams.get('tag');

const filteredLessons = tagFilter
  ? microlessons.filter(entry => entry.data.tags?.includes(tagFilter))
  : microlessons;
---
<BaseLayout>
  <section class="max-w-4xl mx-auto py-10">
    <h1 class="text-3xl font-bold text-white mb-4">Explore Microlessons</h1>
    <div class="mb-4">
      <form method="get" class="flex space-x-2">
        <label for="tag" class="text-white">Filter by tag:</label>
        <select name="tag" id="tag" class="px-2 py-1 rounded">
          <option value="">All</option>
          <option value="Strategy">Strategy</option>
          <option value="Ethics">Ethics</option>
          <option value="Vision">Vision</option>
        </select>
        <button type="submit" class="px-4 py-1 bg-blue-600 text-white rounded">Apply</button>
      </form>
    </div>
    <ul class="space-y-4">
      {filteredLessons.map(entry => (
        <li class="bg-slate-800 p-4 rounded">
          <h2 class="text-xl text-white">{entry.data.title}</h2>
          <p class="text-gray-300">{entry.data.summary}</p>
          <div class="text-sm text-yellow-400 mt-1">Tags: {entry.data.tags?.join(', ')}</div>
        </li>
      ))}
    </ul>
  </section>
</BaseLayout>
